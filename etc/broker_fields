#!/bin/sh

RED_CMD="redis-cli"

($RED_CMD -x SET broker.l2_fields <<EOM
{
  "safe_dev_id": 1,
  "CiscoConfChange": 1,
  "CiscoConfSave": 1,
  "CPUs": 1,
  "memoryUsed": 1,
  "memorySize": 1,
  "data_ip": 1,
  "id": 1,
  "interfaces_sorted": 1,
  "interfaces": {
    "*": {
      "safe_if_name": 1,
      "ifAdminStatus": 1,
      "ifAlias": 1,
      "ifDescr": 1,
      "ifHighSpeed": 1,
      "ifInCRCErrors": 1,
      "ifIndex": 1,
      "ifName": 1,
      "ifOperStatus": 1,
      "ifSpeed": 1,
      "ifType": 1,
      "ips": 1,
      "l2_links": 1,
      "tunnelSrcIfName": 1,
      "portMode": 1,
      "portTrunkVlans": 1,
      "portPvid": 1,
      "portVvid": 1,
      "portHybridTag": 1,
      "portHybridUntag": 1,
      "lag_parent": 1,
      "lag_members": 1,
      "pagp_parent": 1,
      "pagp_members": 1,
      "macs_count": 1,
      "arp_count": 1,
      "lldp_count": 1,
      "cdp_count": 1,
      "routedVlan": 1,
      "routedVlanParent": 1,
      "stpBlockInstances": 1
    }
  },
  "last_seen": 1,
  "model_short": 1,
  "model_long": 1,
  "overall_status": 1,
  "run": 1,
  "short_name": 1,
  "sysObjectID": 1,
  "sysLocation": 1,
  "sysUpTimeStr": 1,
  "vlans": 1
}
EOM
) | grep -i err

($RED_CMD -x SET broker.l3_fields <<EOM
{
  "safe_dev_id": 1,
  "CiscoConfChange": 1,
  "CiscoConfSave": 1,
  "CPUs": 1,
  "memoryUsed": 1,
  "memorySize": 1,
  "data_ip": 1,
  "id": 1,
  "interfaces_sorted": 1,
  "interfaces": {
    "*": {
      "safe_if_name": 1,
      "eigrpIfPeerCount": 1,
      "eigrpIfPkts": 1,
      "eigrp_found_count": 1,
      "ifAdminStatus": 1,
      "ifAlias": 1,
      "ifDescr": 1,
      "ifDelay": 1,
      "ifHighSpeed": 1,
      "ifInCRCErrors": 1,
      "ifIndex": 1,
      "ifName": 1,
      "ifOperStatus": 1,
      "ifSpeed": 1,
      "ifType": 1,
      "ips": 1,
      "tunnelSrcIfName": 1,
      "lag_parent": 1,
      "lag_members": 1,
      "pagp_parent": 1,
      "pagp_members": 1,
      "macs_count": 1,
      "arp_count": 1,
      "lldp_count": 1,
      "cdp_count": 1,
      "routedVlan": 1,
      "routedVlanParent": 1,
      "stpBlockInstances": 1
    }
  },
  "last_seen": 1,
  "model_short": 1,
  "model_long": 1,
  "overall_status": 1,
  "run": 1,
  "short_name": 1,
  "sysObjectID": 1,
  "sysLocation": 1,
  "sysUpTimeStr": 1,
  "vlans": 1
}
EOM
) | grep -i err

($RED_CMD -x SET broker.global-config_fields <<EOM
{
  "safe_dev_id": 1,
  "CiscoConfChange": 1,
  "CiscoConfSave": 1,
  "data_ip": 1,
  "id": 1,
  "interfaces_sorted": 1,
  "interfaces": {
    "*": {
      "eigrpIfPeerCount": 1,
      "eigrpIfPkts": 1,
      "eigrp_found_count": 1,
      "ifAdminStatus": 1,
      "ifAlias": 1,
      "ifDescr": 1,
      "ifHighSpeed": 1,
      "ifInCRCErrors": 1,
      "ifIndex": 1,
      "ifName": 1,
      "ifOperStatus": 1,
      "ifSpeed": 1,
      "ifDelay": 1,
      "ifType": 1,
      "ips": 1,
      "l2_links": 1,
      "tunnelSrcIfName": 1,
      "tunnelDstDecoded": 1,
      "tunnelSrcDecoded": 1,
      "tunnelEncap": 1,
      "tunnelSec": 1,
      "portMode": 1,
      "portTrunkVlans": 1,
      "portPvid": 1,
      "portVvid": 1,
      "portHybridTag": 1,
      "portHybridUntag": 1,
      "lag_parent": 1,
      "lag_members": 1,
      "pagp_parent": 1,
      "pagp_members": 1,
      "macs_count": 1,
      "arp_count": 1,
      "lldp_count": 1,
      "cdp_count": 1,
      "routedVlan": 1,
      "routedVlanParent": 1
    }
  },
  "last_seen": 1,
  "model_short": 1,
  "model_long": 1,
  "overall_status": 1,
  "short_name": 1,
  "sysLocation": 1,
  "sysUpTimeStr": 1,
  "sysDescr": 1,
  "sysName": 1,
  "sysObjectID": 1,
  "vtpDomain": 1,
  "vtpMode": 1,
  "_end": 1
}
EOM
) | grep -i err

($RED_CMD -x SET broker.offline_fields <<EOM
{
  "safe_dev_id": 1,
  "cdp_ports": 1,
  "CiscoConfChange": 1,
  "CiscoConfSave": 1,
  "CPUs": 1,
  "memoryUsed": 1,
  "memorySize": 1,
  "data_ip": 1,
  "id": 1,
  "interfaces_sorted": 1,
  "interfaces": {
    "*": {
      "safe_if_name": 1,
      "eigrpIfPeerCount": 1,
      "eigrpIfPkts": 1,
      "eigrp_found_count": 1,
      "ifAdminStatus": 1,
      "ifAlias": 1,
      "ifDescr": 1,
      "ifDelay": 1,
      "ifHighSpeed": 1,
      "ifInCRCErrors": 1,
      "ifIndex": 1,
      "ifName": 1,
      "ifOperStatus": 1,
      "ifSpeed": 1,
      "ifType": 1,
      "ifPhysAddr": 1,
      "ips": 1,
      "l2_links": 1,
      "lldp_portIndex": 1,
      "cdp_portIndex": 1,
      "tunnelSrcIfName": 1,
      "portMode": 1,
      "portTrunkVlans": 1,
      "portPvid": 1,
      "portVvid": 1,
      "portHybridTag": 1,
      "portHybridUntag": 1,
      "lag_parent": 1,
      "lag_members": 1,
      "pagp_parent": 1,
      "pagp_members": 1,
      "macs_count": 1,
      "arp_count": 1,
      "lldp_count": 1,
      "cdp_count": 1,
      "routedVlan": 1,
      "routedVlanParent": 1,
      "stpBlockInstances": 1
    }
  },
  "invEntParent": 1,
  "invEntName": 1,
  "invEntDescr": 1,
  "invEntCRU": 1,
  "invEntFwRev": 1,
  "invEntHwRev": 1,
  "invEntSwRev": 1,
  "invEntMfg": 1,
  "invEntModel": 1,
  "invEntSerial": 1,
  "invEntType": 1,
  "invEntOrder": 1,
  "last_seen": 1,
  "lldp_ports": 1,
  "model_short": 1,
  "model_long": 1,
  "overall_status": 1,
  "run": 1,
  "short_name": 1,
  "sysObjectID": 1,
  "sysLocation": 1,
  "sysUpTimeStr": 1,
  "vlans": 1
}
EOM
) | grep -i err

TIME=`date +%s`

$RED_CMD SET broker.fields_time $TIME | grep -i err

